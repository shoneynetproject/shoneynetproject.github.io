<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Installing a Virtual Honeywall using VMware</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>Installing a Virtual Honeywall using VMware</h1></div><div><h3 class="corpauthor">Spanish Honeynet Project <a href="http://www.honeynet.org.es" target="_top">http://www.honeynet.org.es</a></h3></div><div><div class="author"><h3 class="author"><span class="firstname">Diego</span> <span class="surname">Gonz&aacute;lez G&oacute;mez</span></h3><tt class="email">&lt;<a href="mailto:dggomez -at- honeynet.org.es">dggomez -at- honeynet.org.es</a>&gt;</tt></div></div><div><p class="copyright">Copyright &copy; &amp; Copyleft 2004 Diego Gonz&aacute;lez. Madrid (Spain). "This paper can be freely copied and republished as long as it is made literally and this note is enclosed." </p></div><div><div class="legalnotice"><p>Published under the free <a href="http://creativecommons.org/licenses/by-nc/1.0/" target="_top">Creative Commons</a> license.</p></div></div><div><p class="pubdate">15 September, 2004. <span class="emphasis"><em>Last updated:</em></span> 14 November, 2004</p></div></div><div></div><hr></div><div class="toc"><dl><dt><span class="section"><a href="#d0e39">1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e87">2. Requirements and design considerations</a></span></dt><dt><span class="section"><a href="#d0e152">3. Virtual honeynets</a></span></dt><dt><span class="section"><a href="#d0e276">4. Configuring VMware</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e284">4.1. Virtual Network configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e292">4.1.1. Linux</a></span></dt><dt><span class="section"><a href="#d0e347">4.1.2. Windows</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e393">4.2. Virtual Machine configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e463">5. Conclusion</a></span></dt></dl></div><div class="abstract"><p class="title"><b>Abstract</b></p><p><span class="emphasis"><em>The Honeywall CDROM makes the implementation of a GenII Honeynet Gateway easier. Furthermore, if it is installed on a virtual machine, it will also include the many advantages that a virtual machine environment offers. This paper therefore, explains how to go about configuring <span class="application">VMware</span> to deploy a Honeywall.</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e39"></a>1.&nbsp;Introduction</h2></div></div><div></div></div><p>The <a href="http://www.honeynet.org/tools/cdrom/" target="_top">Honeywall CDROM</a> is a bootable CD with a set of open source tools configured by the Honeynet Project to make the implementation of a GenII Honeynet Gateway easier. Using this document as an installation guide, we are going to implement the Honeywall using the commercial software, <span class="application">VMware</span> . This document makes a few assumptions, one of them is that you have read and understood the papers <a href="http://www.honeynet.org/papers/virtual/" target="_top">Know Your Enemy: Virtual Honeynets</a>, <a href="http://www.honeynet.org/papers/vmware/" target="_top">Know Your Enemy: Learning with VMware</a>, <a href="http://www.honeynet.org/papers/cdrom/" target="_top">Know Your Enemy: Honeywall CDROM</a>.</p><p><span class="application">VMware</span> is virtualization software that allows the running of multiple operating systems at the same time on Intel x86 architectures. It was and is developed by <a href="http://www.vmware.com/" target="_top">VMware Inc.</a> and it has three product lines, namely Workstation, GSX, and ESX. We will be using Workstation. You can download a free evaluation version <a href="http://www.vmware.com/vmwarestore/newstore/wkst_eval_login.jsp" target="_top">here</a>.</p><p>Several tools included in the CD are only available for GNU/Linux platforms. One of the advantages of using <span class="application">VMware</span> is that it permits the implementation of the Honeywall under any operating system supported by this program. Up until the CD was released, the only way to install a complete Honeywall under Windows (with traffic limiting capabilities using iptables, for example) was to first install <span class="application">VMware</span> and then configure a GNU/Linux distribution under it. But now, with the introduction of the Honeywall CDROM this task is very straightforward.</p><p>Another reason for implementing the Honeywall using <span class="application">VMware</span> is that by default, Honeywall uses all resources of the machine you install it on. If a virtual environment is used then this is restricts the Honeywall to use only the resources inside the virtual machine. The advantage is that it is not necessary to consume all the resources of a machine to install the Honeywall CDROM.</p><p>Finally, <span class="application">VMware</span> is a good tool for testing purposes. It is an excellent option to develop and experiment with multiple customized Honeywall CDROMs in a controlled environment.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e87"></a>2.&nbsp;Requirements and design considerations</h2></div></div><div></div></div><p>The hardware requirements needed to install the Honeynet Gateway are specified at the <a href="http://www.honeynet.org/tools/cdrom/" target="_top">Honeywall CDROM page</a>. For proper operation in a Virtual Machine environment, these hardware requirements should be specified in the <span class="application">VMware</span> guest OS panel. The Honeywall CDROM version 0.68 does not support SCSI hard disks; therefore IDE devices must be used. The hard disk size depends a lot on the network traffic and the period of time in which the Honeywall is going to be used. The Honeywall uses a minimum of 500 MB of disk space for swap. The remaining space is used for storing the log files.</p><p>The overall architecture of the Virtual Honeywall is illustrated in the <a href="#fig1" title="Figure&nbsp;1.&nbsp;General Architecture">figure 1</a>. Remember that the Host OS could be any of the supported by <span class="application">VMware</span>, based either on Linux or on Windows.</p><div class="figure"><a name="fig1"></a><p class="title"><b>Figure&nbsp;1.&nbsp;General Architecture</b></p><div class="mediaobject" align="center"><img src="resources/archit.png" align="middle" alt="General Architecture"></div></div><p>The host machine has three physical network interfaces. The third interface is optional and it is used for remote management. The Guest OS, naturally, is the Honeywall CDROM (based on a modified version of William Salusky's <a href="http://fire.dmzs.com/" target="_top">FIRE CD</a>, with Linux kernel version 2.4). Each network adapter of the Guest OS is bridged to its respective physical network interface.</p><p>The Honeywall works in bridge mode, since it is the safest and stealthiest option. Therefore, only the network management interface of the Guest OS has an IP stack. However, if deemed necessary the Host OS can define IP addresses for any of its network interfaces without problems. If so, proper security measures must be defined. Naturally, if the Host OS is compromised, the Guest OS is too.</p><p>The latest version of the Honeywall CDROM can be configured to periodically send captured information and summary activity reports to a remote system. If the Host OS has an IP address it can be used for Data Collecting, storing the data sent by the Honeywall, and for Data Analysis, allowing the opportunity to carefully examine the collected data.</p><p>The IP stack for each network adapter can be disabled following the instructions below:</p><div class="itemizedlist"><ul type="disc"><li><p>In Linux, execute the command '<tt class="literal">ifconfig &lt;interface name&gt; 0.0.0.0</tt>'.</p></li><li><p>In Windows, open the properties of the network connection to be modified and disable the 'Internet Protocol TCP/IP' option.</p></li></ul></div><p>One common problem when installing several network interfaces is determining which network interface corresponds to which physical port. The following method is as good as any other:</p><div class="orderedlist"><ol type="1"><li><p>Plug the network cable to only one network interface.</p></li><li><p>Disable all the network interfaces and then, enable and configure with a valid IP address one of them.</p></li><li><p>Try to probe another host in the LAN using the IP destination address, not the DNS name. For example, making a PING to the gateway.</p></li><li><p>If no response is received, unplug the network cable and plug it into consecutive network ports until you are successful. Also make sure that the connections being tried are not blocked by any intermediate network device.</p></li><li><p>Repeat steps 2 to 4 to identify the rest of the interfaces.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e152"></a>3.&nbsp;Virtual honeynets</h2></div></div><div></div></div><p>Depending on the way the virtualization software is used, the <a href="http://www.honeynet.org/papers/virtual/" target="_top">Virtual Honeynets</a> can be classified as Self-contained or Hybrid.</p><p><span class="bold"><b>Self-contained Virtual Honeynets</b></span> integrate the whole network into only one physical system. You can read a complete guide for installing a Self-contained Virtual Honeynet, using <span class="application">VMware</span> and the Honeywall CDROM at the <a href="http://www.honeynet.org.pk/honeywall/" target="_top">Pakistan Honeynet Project</a> site. These kinds of Virtual Honeynets have several advantages:</p><div class="itemizedlist"><ul type="disc"><li><p>Central management.</p></li><li><p>Consolidated Honeynet system.</p></li><li><p>Low cost as only one machine is required.</p></li><li><p>Portable, if installed for example on a laptop.</p></li><li><p>Easier deployment. Only one system needs to be implemented and connected.</p></li></ul></div><p>However, important limitations should also be kept into account:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="application">VMware</span> only supports x86 platforms. This limits the software that can be used in the Honeynet.</p></li><li><p>Any problem with the hardware would affect the entire honeynet.</p></li><li><p>A powerful system is needed, depending of the kind and number of Guest OS&#8217; used (watch for memory and processor consumption).</p></li><li><p>The virtualization software, as in any other software, is susceptible to being compromised by an attacker that could take control over the entire Honeynet.</p></li><li><p>An attacker inside a compromised honeypot can easily <a href="http://www.phrack.org/fakes/p63/p63-0x09.txt" target="_top">determine if it is a virtual environment</a>.</p></li></ul></div><p><span class="bold"><b>Hybrid Virtual Honeynets</b></span> combine real and virtual systems. Data Capture and Data Control are deployed on an isolated system, and the honeypots are virtual systems run on a single box. In their advantages, they are:</p><div class="itemizedlist"><ul type="disc"><li><p>More secure. The Honeywall is in a separate system, and if it is running in bridge mode the attacker can only view and attack the honeypots.</p></li><li><p>More flexible. There are fewer limitations with the software that can be used either in the Honeywall or in the honeypots.</p></li></ul></div><p>Some disadvantages are:</p><div class="itemizedlist"><ul type="disc"><li><p>They are not very portable, since due to its nature the number of physical systems increases.</p></li><li><p>They are more expensive in time, money and space, since it involves the deployment of several devices in the network.</p></li></ul></div><p>The solution proposed here uses <span class="application">VMware</span> just to install the Honeywall. On top of that, the honeypots can be installed in one of the following ways:</p><div class="orderedlist"><ol type="1"><li><p>On another system (using other virtualization software such as <span class="application">VMware</span> or User Mode Linux). This would be a Hybrid Virtual Network.</p></li><li><p>A better option, install a honeypot(s) on a set of real systems, to avoid remote fingerprinting issues.</p></li><li><p>A third and last option would consist in a combination of the previous two. See <a href="#fig2" title="Figure&nbsp;2.&nbsp;Virtual Honeywall with virtual and real Honeypots">figure 2</a>.</p><div class="figure"><a name="fig2"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Virtual Honeywall with virtual and real Honeypots</b></p><div class="mediaobject" align="center"><img src="resources/mixed.png" align="middle" alt="Virtual Honeywall with virtual and real Honeypots"></div></div></li></ol></div><p>Using <span class="application">VMware</span> to deploy only the Honeywall may be considered a special case of a Hybrid Virtual Honeynet, because it uses virtualization software for the Honeywall and the honeypots can be virtual or otherwise. It has the following advantages:</p><div class="itemizedlist"><ul type="disc"><li><p>OS independent. The Honeywall can be installed (and tested) on any Host OS supported by the virtualization software, and the equipment used does not lose any existing data.</p></li><li><p>More secure. As with the Hybrid Virtual Honeynets, the Honeywall is in a separate system and is running in bridge mode. This permits the attacker to only see and attack the honeypots.</p></li><li><p>Flexibility. The honeypots can be installed in a virtual environment or as real systems.</p></li></ul></div><p>And also these disadvantages:</p><div class="itemizedlist"><ul type="disc"><li><p>It is less portable, since several machines are needed.</p></li><li><p>It is more expensive in time, money and space to assign and configure several devices.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e276"></a>4.&nbsp;Configuring VMware</h2></div></div><div></div></div><p>The configuration of <span class="application">VMware</span> is very straightforward. Once installed, before creating the new Virtual Host, it is necessary to set up the virtual networks.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e284"></a>4.1.&nbsp;Virtual Network configuration</h3></div></div><div></div></div><p>This subsection explains how to configure the network interfaces to work as illustrated in <a href="#fig1" title="Figure&nbsp;1.&nbsp;General Architecture">figure 1</a>. The instructions depend on the OS used.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e292"></a>4.1.1.&nbsp;Linux</h4></div></div><div></div></div><p>The <tt class="filename">vmware-config.pl</tt> command is used to define the virtual networks. The following output was captured when configuring <span class="application">VMware</span> under Linux.</p><pre class="screen">[root@hwall vmware]# <b class="userinput"><tt>vmware-config.pl</tt></b>
Making sure services for VMware Workstation are stopped.
 
[...]
 
Would you like to skip networking setup and keep your old settings as they
are?
(yes/no) [no]
 
Do you want networking for your virtual machines? (yes/no/help) [yes]
 
Would you prefer to modify your existing networking configuration using the
wizard or the editor? (wizard/editor/help) [editor]
 
The following virtual networks have been defined:
 
. vmnet0 is bridged to eth0
. vmnet1 is a host-only network on private subnet 10.10.10.0.
. vmnet8 is a NAT network on private subnet 10.10.10.0.
 
Do you wish to make any changes to the current virtual networks settings?
(yes/no) [no] <b class="userinput"><tt>yes</tt></b>
 
Which virtual network do you wish to configure? (0-99) <b class="userinput"><tt>1</tt></b>
 
The network vmnet1 has been reserved for a host-only network.  You may change
it, but it is highly recommended that you use it as a host-only network.  Are
you sure you want to modify it? (yes/no) [no] <b class="userinput"><tt>yes</tt></b>
 
What type of virtual network do you wish to set vmnet1?
(bridged,hostonly,nat,none) [hostonly] <b class="userinput"><tt>none</tt></b>
 
Removing a host-only network for vmnet1.
 
The following virtual networks have been defined:
 
. vmnet0 is bridged to eth0
. vmnet8 is a NAT network on private subnet 10.10.10.0.
 
Do you wish to make additional changes to the current virtual networks
settings?(yes/no) [yes]
 
Which virtual network do you wish to configure? (0-99) <b class="userinput"><tt>8</tt></b>
 
The network vmnet8 has been reserved for a NAT network.  You may change it,
but
it is highly recommended that you use it as a NAT network.  Are you sure you
want to modify it? (yes/no) [no] <b class="userinput"><tt>yes</tt></b>
 
What type of virtual network do you wish to set vmnet8?
(bridged,hostonly,nat,none) [nat] <b class="userinput"><tt>none</tt></b>
 
Removing a NAT network for vmnet8.
 
The following virtual networks have been defined:
 
. vmnet0 is bridged to eth0
 
Do you wish to make additional changes to the current virtual networks
settings?(yes/no) [yes]
 
Which virtual network do you wish to configure? (0-99) <b class="userinput"><tt>2</tt></b>
 
What type of virtual network do you wish to set vmnet2?
(bridged,hostonly,nat,none) [none] <b class="userinput"><tt>bridged</tt></b>
 
Configuring a bridged network for vmnet2.
 
Your computer has multiple ethernet network interfaces available: eth1, eth2.
Which one do you want to bridge to vmnet2? [eth0] <b class="userinput"><tt>eth1</tt></b>
 
The following virtual networks have been defined:
 
. vmnet0 is bridged to eth0
. vmnet2 is bridged to eth1
 
Do you wish to make additional changes to the current virtual networks
settings?(yes/no) [yes]
 
Which virtual network do you wish to configure? (0-99) <b class="userinput"><tt>3</tt></b>
 
What type of virtual network do you wish to set vmnet3?
(bridged,hostonly,nat,none) [none] <b class="userinput"><tt>bridged</tt></b>
 
Configuring a bridged network for vmnet3.
 
The following virtual networks have been defined:
 
. vmnet0 is bridged to eth0
. vmnet2 is bridged to eth1
. vmnet3 is bridged to eth2
 
Do you wish to make additional changes to the current virtual networks
settings?(yes/no) [yes] <b class="userinput"><tt>no</tt></b>
 
Do you want this program to automatically configure your system to allow your
virtual machines to access the host's filesystem? (yes/no/help) [no]
 
Starting VMware services:
   Virtual machine monitor                                 [  OK  ]
   Virtual ethernet                                        [  OK  ]
   Bridged networking on /dev/vmnet0                       [  OK  ]
   Bridged networking on /dev/vmnet2                       [  OK  ]
   Bridged networking on /dev/vmnet3                       [  OK  ]
 
The configuration of VMware Workstation 4.5.2 build-8848 for Linux for this
running kernel completed successfully.
 
You can now run VMware Workstation by invoking the following command:
"/usr/bin/vmware".
 
[...]</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e347"></a>4.1.2.&nbsp;Windows</h4></div></div><div></div></div><p>In the Windows version of <span class="application">VMware</span>, the virtual network properties are configured with the '<span class="application">Virtual Network Editor</span>'. Go to '<span class="guimenu">Host Virtual Adapters</span>' and remove (if they exist) the network adapters vmnet1 (host-only) and vmnet8 (NAT). Then, go to '<span class="guimenu">Host Virtual Network Mapping</span>' and bridge the three network interfaces to <tt class="literal">vmnet0</tt>, <tt class="literal">vmnet2</tt> and <tt class="literal">vmnet3</tt> respectively. The configuration should be similar to the illustrated in <a href="#fig3" title="Figure&nbsp;3.&nbsp;Virtual Network Editor - Host Virtual Network Mapping">figure 3</a>.</p><div class="figure"><a name="fig3"></a><p class="title"><b>Figure&nbsp;3.&nbsp;Virtual Network Editor - Host Virtual Network Mapping</b></p><div class="mediaobject" align="center"><img src="resources/vmwarewn.png" align="middle" alt="Virtual Network Editor - Host Virtual Network Mapping"></div></div><p>Close the '<span class="application">Virtual Network Editor</span>' and open the Windows Services editor to stop and disable '<span class="application">VMware DHCP service</span>' and '<span class="application">VMware NAT service</span>'.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e393"></a>4.2.&nbsp;Virtual Machine configuration</h3></div></div><div></div></div><p>Create a New Virtual Machine. In order to specify the kind of hard disk used, select the '<span class="guibutton">Custom</span>' option during the creation process (remember that the Honeywall CDROM version 0.68 only supports IDE). Check '<span class="guibutton">Linux</span>' as the Guest OS, and '<span class="guibutton">Other Linux 2.4.x kernel</span>' as the version. At least 256 MB of memory should be specified. Under Network Connection, choose '<span class="guibutton">Use bridged networking</span>'. The recommended size of the IDE hard disk is 30 GB, but a lot depends on the amount of traffic expected to be recorded.</p><p>Once the new Virtual Machine is created, edit it&#8217;s settings to add the Ethernet interfaces. First task is to edit the existing network adapter: Under '<span class="guimenu">Network connection</span>' choose '<span class="guibutton">Custom</span>' and choose <tt class="literal">vmnet0</tt> device. Then, we add an additional Ethernet Adapter, choosing <tt class="literal">vmnet2</tt> device. Repeat this operation and create another Ethernet Adapter, <tt class="literal">vmnet3</tt>. <tt class="literal">Vmnet1</tt> adapter is not chosen because it is used by default for host-only networks.</p><p>At this point the Guest OS should be ready. If an ISO image is used, instead of a recorded CDROM, the Guest OS will run faster. Lastly, to avoid boot errors, it is highly recommended to change the devices boot order in the BIOS configuration of the Virtual Machine. Open it by pressing F2 at boot time and put the CDROM drive as primary boot device. There is further useful information regarding the implementation of the Honeywall CDROM at it&#8217;s homepage.</p><p>Here are snapshots of the Virtual Honeywall running under both <a href="resources/hwlinux.png" target="_top">Red Hat Linux</a> and <a href="resources/hwwin.png" target="_top">Windows XP</a>.</p><div class="figure"><a name="d0e440"></a><p class="title"><b>Figure&nbsp;4.&nbsp;Virtual Honeywall under Red Hat Linux</b></p><div class="mediaobject" align="center"><img src="resources/hwlinux.png" align="middle" width="378" alt="Virtual Honeywall under Red Hat Linux"></div></div><div class="figure"><a name="d0e446"></a><p class="title"><b>Figure&nbsp;5.&nbsp;Virtual Honeywall under Windows XP</b></p><div class="mediaobject" align="center"><img src="resources/hwwin.png" align="middle" width="378" alt="Virtual Honeywall under Windows XP"></div></div><p>If the Host OS is Linux and the Honeywall CDROM does not detect the Ethernet Adapters, change the '<span class="guimenu">Use virtual device</span>' configuration of the network adapters from '<tt class="option">vlance</tt>' to '<tt class="option">vmxnet</tt>' option.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e463"></a>5.&nbsp;Conclusion</h2></div></div><div></div></div><p>Deploying a Virtual Honeywall combines the advantages offered by the Honeywall CDROM and the virtual environments.</p><p>It is very straightforward, it is safe, it can be installed on any OS (supported by <span class="application">VMware</span>), and it does not need to remove any information previously stored on the host machine. In fact, it leaves the opportunity to use the Host OS to perform Data Collection and Data Analysis functions.</p><p></p><div class="mediaobject" align="center"><img src="resources/shp_logo.png" align="middle"></div></div></div></body></html>